% Copyright 2017 by Christian Senger <senger@inue.uni-stuttgart.de>
%
% This file may be distributed and/or modified
%
% 1. under the LaTeX Project Public License and/or
% 2. under the GNU Public License.
%
% See the file doc/licenses/LICENSE for more details.

% reset footnote counter per page, adapt footnotes
\usepackage{perpage}
\MakePerPage{footnote}
\renewcommand*{\thefootnote}{\fnsymbol{footnote}}
\renewcommand\footnoterule{}

% table with newcoloumntype
\usepackage{array}

%% REMOVE THIS BLOCK IF THERE ARE FONT PROBLEMS AND USE \usepackage{helvet} INSEAD
% set up fonts
\usepackage{lmodern}
\usepackage{fontspec}
\setsansfont{Arial}[
  Scale = MatchUppercase,
]
%% REMOVE THIS BLOCK IF THERE ARE FONT PROBLEMS AND USE HELVET INSTEAD

\renewcommand{\familydefault}{\sfdefault}

%% fix German quotation marks
%\DeclareUTFcharacter[\UTFencname]{x201C}{\grqq}
%\DeclareUTFcharacter[\UTFencname]{x201E}{\glqq}

% use fancy enumerate/itemize and restore beamer layout
\usepackage{enumitem}\setitemize{%
  label=\usebeamerfont*{itemize item}
  \usebeamercolor[fg]{itemize item}
  \usebeamertemplate{itemize item}
}

% fix enumerate
% from Stefan Kottwitz, https://tex.stackexchange.com/a/45950
\setenumerate[1]{%
  label=\protect\usebeamerfont{enumerate item}%
        \protect\usebeamercolor[fg]{enumerate item}%
        \insertenumlabel.}

\usepackage{tikz}

% positioning e.g. for section in toc
\usetikzlibrary{positioning}

\makeatletter
\def\beamerrightmargin{\dimexpr\Gm@rmargin\relax}
\makeatother

\mode<presentation>

% add counter used in the outer theme
\newcounter{framediff}
% set outer theme
\useoutertheme{uniS}
\useinnertheme{rectangles}

\usecolortheme{uniS}

\usefonttheme{professionalfonts}
\setbeamerfont{block title}{size=\small}

\setbeamersize{text margin left=.5cm}
\setbeamersize{text margin right=.5cm}

\setbeamertemplate{navigation symbols}{}


% plain text in theorems
\addtobeamertemplate{theorem begin}{\upshape}{}
% Remove shadow and rounded corners
\setbeamertemplate{blocks}[rounded=false, shadow=false]

\newcommand{\photocredit}[1]{%
  \begingroup
  \renewcommand\thefootnote{}\footnote{\tiny Photo credit: #1}%
  \addtocounter{footnote}{-1}%
  \endgroup
}
\newcolumntype{L}[1]{>{\raggedright\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}

\newcommand{\finalslide}[3]{
  \begin{frame}[plain,noframenumbering]
    \begin{tikzpicture}[overlay, remember picture]
      \clip (current page.north west) rectangle (current page.south east);
      % uncomment in order to repeat title page background, also uncomment opacity below
      %\node[anchor=north west] at ([xshift=-1em, yshift=1ex]current page.north west) {\pgfuseimage{background}};
      \shade[%
        top color=uniSlightblue,
        bottom color=uniSblue,
        shading angle=-45,
        %opacity=.8
        ]
        (current page.north west) rectangle (current page.south east);
        \node[anchor=north west] at ([xshift=1cm, yshift=-1cm]current page.north west) {\pgfuseimage{unilogow}};
    \node[anchor=north east] at ([xshift=-1.1cm, yshift=-1.7cm]current page.north east) {\pgfuseimage{institutelogow}};
    \node[anchor=north east] at ([xshift=-1cm, yshift=-.8cm]current page.north east) {\pgfuseimage{simtechlogow}};
    \end{tikzpicture}

    \vspace{4cm}

    \begin{columns}[c]
      \begin{column}{2.5cm}

        \begin{tikzpicture}
        \node[circle,minimum size=2.5cm, path picture={
          \node at (path picture bounding box.center){\pgfuseimage{speaker}};}] {};
        \end{tikzpicture}
      \end{column}
      \begin{column}{0.6\textwidth}

        \begin{beamercolorbox}%[leftskip=3ex, ht=2em,wd=\paperwidth]
          {palette tertiary}
          \begin{tabular}{p{1cm}L{\textwidth}}
            \multicolumn{2}{l}{\insertshortauthor}\\
            \multicolumn{2}{L{\textwidth}}{\insertinstitute~(\insertshortinstitute)}\\
            \multicolumn{2}{l}{\university}\\
            \rule{0pt}{4ex}\\
            eMail & \href{mailto:#1}{#1}\\
            phone  & #2
          \end{tabular}
        \end{beamercolorbox}
      \end{column}
    \end{columns}

  \end{frame}
}

\newlength{\circlesize}

\setbeamertemplate{title page}%
{
  \setlength{\circlesize}{1.12\textheight}
  \begin{tikzpicture}[overlay, remember picture]
    \clip (current page.north west) rectangle (current page.south east);
    \node[anchor=south west, inner sep=0pt] at (current page.south west)
    %  {\includegraphics[width=\textwidth+1em+2\beamerrightmargin]{bg.jpg}};
      {\pgfuseimage{background}};
    \node[%
      rectangle,
      draw=white,
      fill=white,
      anchor=north west,
      minimum width=2\textwidth,
      minimum height=3cm]
      at (current page.north west) {};
    \node[anchor=north west] at ([xshift=1cm, yshift=-.06\paperheight]current page.north west) {\pgfuseimage{unilogo}};
    \node[anchor=north west] at ([xshift=2.13cm, yshift=-(0.06\paperheight+1.32cm)]current page.north west) {\pgfuseimage{institutelogo}};
    \node[anchor=north west] at ([xshift=3.9cm, yshift=-(0.06\paperheight+1.1cm)]current page.north west) {\pgfuseimage{simtechlogo}};
    \node[%
      circle,
      fill=uniSgray,
      anchor=south east,
      minimum size=\circlesize,]
      (title) at ([yshift=-.05\circlesize]current page.south east) {};
    \node[%
      text=white,
      align=left,
      font=\bfseries\LARGE,
      anchor = west]
      (titleString) at ([xshift=.1\circlesize, yshift=.025\circlesize]title.west) {\inserttitle};
    \node[%
      text=white,
      anchor = north west,
      align = left]
      (date) at (titleString.south west) {\insertsubtitle\\ \insertdate};
    \setlength{\circlesize}{.2\textheight}
    \node[%
      circle,
      fill=white,
      anchor=center,
      minimum size=\circlesize,
      align=left,
      font=\bfseries\footnotesize]
      at ([xshift=-.1\circlesize, yshift=-.6\circlesize]title.north west) {\insertauthor};
  \end{tikzpicture}
}

\setbeamertemplate{section page}%
{
  \begin{tikzpicture}[overlay, remember picture]
    \setlength{\circlesize}{.9\textheight}
    \clip (current page.north west) rectangle (current page.south east);
    \shade[%
      top color=uniSlightblue,
      bottom color=uniSblue,
      shading angle=-45]
      (current page.north west) rectangle (current page.south east);
    \node[%
      circle,
      fill=white,
      anchor=north west,
      minimum size=\circlesize,
      text width=.8\circlesize,
      align=left,
      font=\bfseries\Large]
      (sectiontitle) at ([xshift=.1\circlesize, yshift=-.2\circlesize]current page.north west) {\insertsection};
    \setlength{\circlesize}{.2\textheight}
    \node[%
      circle,
      fill=uniSgray,
      text=white,
      anchor=center,
      minimum size=\circlesize,
      align=left,
      font=\bfseries\Huge]
      at ([xshift=-.1\circlesize, yshift=-.3\circlesize]sectiontitle.south east) {\thesection};
  \end{tikzpicture}
}

\setbeamertemplate{section in toc}{%
  \usebeamercolor[bg]{item projected}%
  \begin{tikzpicture}[node distance=.5em]
    \node[anchor=base, baseline, fill=uniSgray, text=white, circle, inner sep=0pt, minimum size=2em] (no) {\inserttocsectionnumber};
    \node[right=of no] {\color{uniSblue} \inserttocsection};
  \end{tikzpicture}
}

\setbeamerfont{frametitle}{series=\bfseries}
\addtobeamertemplate{frametitle}{\vspace{.5em}}{} % increase
%\setbeamertemplate{frametitle}%
%{
%  \nointerlineskip
%  \begin{beamercolorbox}[leftskip=2ex, ht=2em,wd=\paperwidth]{frametitle}
%    \bfseries\Large\insertframetitle\strut
%  \end{beamercolorbox}
%}

\setbeamertemplate{itemize/enumerate body begin}{\footnotesize}

\setbeamertemplate{itemize/enumerate subbody begin}{\footnotesize}

\setbeamertemplate{itemize item}{%
  \usebeamercolor[bg]{item projected}%
  \begin{tikzpicture}
    \draw[uniSgray,fill=uniSgray, opacity=0] (0,0) circle (.1695em);
    \draw[uniSgray,fill=uniSgray] (.1695em, .1695em) circle (.1695em);
  \end{tikzpicture}
}

\setbeamertemplate{bibliography item}{\insertbiblabel}

\defbeamertemplate{note page}{notepageuniS}
{
  \insertvrule{0.45\paperheight}{uniSgray!20}%
  \vskip-0.45\paperheight
  \insertslideintonotes{0.45}

  \noindent\hspace{1em}\begin{minipage}{.9\paperwidth}
    \footnotesize
    \setlist{noitemsep}
    \insertnote
  \end{minipage}
}

\setbeamertemplate{note page}[notepageuniS]

\mode
<all>
